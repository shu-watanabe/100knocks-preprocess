---
title: "Your answer sheet for DS １００本ノック"
author: "Your name"
date: "令和2年07月01日"
output:
  html_document:
    toc: true
    toc_float: true
---
## はじめに

データサイエンス100本ノックの dockerを使わずに、直接 RStudio などで解答するための、
Rmd 文書です。
RStudio (https://rstudio.com/) でテストしていますが、 Rmd ([R Markdown](https://rmarkdown.rstudio.com/)) をUTF-8で処理できる
環境ならWindows, MacOS, Linux でも問題なく動くと思います。

## loading

もし、"という名前のパッケージはありません" と言われる場合は、直下のスクリプトを実行しましょう。
一度 R システムにインストールされたらバージョンアップデートの時まで実行する必要はありません。
この `eval=FALSE` と書いてあるブロックは、自動的には実行されませんので、
文書には表示しても、毎度実行するわけではない部分に付けます。

```{r,eval=FALSE}
install.packages("dplyr")
install.packages("tidyr")
install.packages("purrr")
install.packages("stringr")
install.packages("rsample")
```

パッケージを追加する必要がある場合は、ここに加えましょう。
```{r setup}
knitr::opts_chunk$set(echo = TRUE)
require(plyr)
require(dplyr)
require(tidyr)
require(purrr)
require(stringr)
require(rsample)
```

PostgreSQL サーバー経由ではなく、直接読み込んでみる場合用です。 同じ構造を持つように調整してあります。
```{r}
df_receipt <- read.csv(
  'data/receipt.csv',
  colClasses=c('integer','integer',
               'character','integer',
               'integer','character',
               'character','integer',
               'integer'),
  stringsAsFactors = FALSE)

df_customer <- read.csv(
    'data/customer.csv',
    fileEncoding = 'utf-8',
    colClasses=c(
      'character','character','character','character',
      'character','integer','character','character',
      'character','character','character'
    ),
    stringsAsFactors = FALSE) %>%
  mutate(birth_day=as.Date(birth_day))

df_store <- read.csv(
    'data/store.csv',
    fileEncoding = 'utf-8',
    colClasses=c(
      rep('character',7),rep('numeric',3)
    ),
    stringsAsFactors = FALSE)

df_product <- read.csv(
    'data/product.csv',
    fileEncoding = 'UTF-8-BOM',
    colClasses=c(
      rep('character',4),rep('integer',2)
    ),
    stringsAsFactors = FALSE)

df_category <- read.csv(
    'data/category.csv',
    fileEncoding = 'UTF-8-BOM',
    colClasses=rep('character',6),
    stringsAsFactors = FALSE)

df_geocode <- read.csv(
    'data/geocode.csv',
    fileEncoding = 'UTF-8-BOM',
    colClasses= c(rep('character',7),rep('numeric',2)),
    stringsAsFactors = FALSE)
```

## 100 knocks

### 001-003 列に対する操作

#### R-001

> レシート明細のデータフレーム（df_receipt）から全項目の先頭10件を表示し、どのよう
なデータを保有しているか目視で確認せよ。

```{r}
```

#### R-002

>レシート明細のデータフレーム（df_receipt）から売上日（sales_ymd）、顧客ID
（customer_id）、商品コード（product_cd）、売上金額（amount）の順に列を指定し、
10件表⽰させよ。

```{r}
```

#### R-003

> レシート明細のデータフレーム（df_receipt）から売上日（sales_ymd）、顧客ID
（customer_id）、商品コード（product_cd）、売上金額（amount）の順に列を指定し、
10件表⽰させよ。ただし、sales_ymdはsales_dateに項⽬名を変更しながら抽出するこ
と。

```{r}
```

### 004-009 行に対する操作

#### R-004

> レシート明細のデータフレーム（df_receipt）から売上日（sales_ymd）、顧客ID
（customer_id）、商品コード（product_cd）、売上金額（amount）の順に列を指定し、
以下の条件を満たすデータを抽出せよ。
> 
> * 顧客ID（customer_id）が"CS018205000001"

```{r}
```

#### R-005

> レシート明細のデータフレーム（df_receipt）から売上日（sales_ymd）、顧客ID
（customer_id）、商品コード（product_cd）、売上金額（amount）の順に列を指定し、
以下の条件を満たすデータを抽出せよ。
>
> * 顧客ID（customer_id）が"CS018205000001"
> * 売上⾦額（amount）が1,000以上

```{r}
```

#### R-006

> レシート明細データフレーム「df_receipt」から売上日（sales_ymd）、顧客ID
（customer_id）、商品コード（product_cd）、売上数量（quantity）、売上金額
（amount）の順に列を指定し、以下の条件を満たすデータを抽出せよ。
> 
> * 顧客ID（customer_id）が"CS018205000001"
> * 売上⾦額（amount）が1,000以上または売上数量（quantity）が5以上

```{r}
```

#### R-007

> レシート明細のデータフレーム（df_receipt）から売上日（sales_ymd）、顧客ID
（customer_id）、商品コード（product_cd）、売上金額（amount）の順に列を指定し、
以下の条件を満たすデータを抽出せよ。
> 
> * 顧客ID（customer_id）が"CS018205000001"
> * 売上⾦額（amount）が1,000以上2,000以下

```{r}
```


#### R-008

> レシート明細のデータフレーム（df_receipt）から売上日（sales_ymd）、顧客ID
（customer_id）、商品コード（product_cd）、売上金額（amount）の順に列を指定し、
以下の条件を満たすデータを抽出せよ。
> 
> * 顧客ID（customer_id）が"CS018205000001"
> * 商品コード（product_cd）が"P071401019"以外

```{r}
```

#### R-009

> 以下の処理において、出力結果を変えずにORをANDに書き換えよ。
>
```{r,eval=FALSE}
df_store %>%
  filter(!(prefecture_cd==13 | floor_area >900))
```

```{r}
```

### 010-016 あいまい条件

#### R-010

> 店舗データフレーム（df_store）から、店舗コード（store_cd）が"S14"で始まるものだけ
全項目抽出し、10件だけ表示せよ。

```{r}
```

#### R-011

> 顧客データフレーム（df_customer）から顧客ID（customer_id）の末尾が1のものだけ全
項目抽出し、10件だけ表示せよ。

```{r}
```

#### R-012

> 店舗データフレーム（df_store）から横浜市の店舗だけ全項目表示せよ。

```{r}
```

#### R-013

> 顧客データフレーム（df_customer）から、ステータスコード（status_cd）の先頭がアル
ファベットのA〜Fで始まるデータを全項目抽出し、10件だけ表示せよ。

```{r}
```

#### R-014

> 顧客データフレーム（df_customer）から、ステータスコード（status_cd）の末尾が数字
の1〜9で終わるデータを全項目抽出し、10件だけ表示せよ。

```{r}
```

#### R-015

> 顧客データフレーム（df_customer）から、ステータスコード（status_cd）の先頭がアル
ファベットのA〜Fで始まり、末尾が数字の1〜9で終わるデータを全項目抽出し、10件だ
け表示せよ。

```{r}
```

#### R-016

> 店舗データフレーム（df_store）から、電話番号（tel_no）が3桁-3桁-4桁のデータを全項
目表示せよ。

```{r}
```

### 017-020 ソート

#### R-017

> 顧客データフレーム（df_customer）を生年月日（birth_day）で高齢順にソートし、先頭
10件を全項⽬表⽰せよ。

```{r}
```

#### R-018

> 顧客データフレーム（df_customer）を生年月日（birth_day）で若い順にソートし、先頭
10件を全項⽬表⽰せよ。

```{r}
```

#### R-019

> レシート明細データフレーム（df_receipt）に対し、1件あたりの売上金額（amount）が
高い順にランクを付与し、先頭10件を抽出せよ。項目は顧客ID（customer_id）、売上金
額（amount）、付与したランクを表示させること。なお、売上金額（amount）が等しい
場合は同一順位を付与するものとする。

```{r}
```

#### R-020

> レシート明細データフレーム（df_receipt）に対し、1件あたりの売上金額（amount）が
高い順にランクを付与し、先頭10件を抽出せよ。項目は顧客ID（customer_id）、売上金
額（amount）、付与したランクを表示させること。なお、売上金額（amount）が等しい
場合でも別順位を付与すること。

```{r}
```

### 021-033 集計

#### R-021

> レシート明細データフレーム（df_receipt）に対し、件数をカウントせよ。

```{r}
```


#### R-022

> レシート明細データフレーム（df_receipt）の顧客ID（customer_id）に対し、ユニーク件
数をカウントせよ。

```{r}
```


#### R-023

> レシート明細データフレーム（df_receipt）に対し、店舗コード（store_cd）ごとに売上
金額（amount）と売上数量（quantity）を合計せよ。

```{r}
```

#### R-024

> レシート明細データフレーム（df_receipt）に対し、顧客ID（customer_id）ごとに最も新
しい売上日（sales_ymd）を求め、10件表示せよ。

```{r}
```

#### R-025

> レシート明細データフレーム（df_receipt）に対し、顧客ID（customer_id）ごとに最も古
い売上日（sales_ymd）を求め、10件表示せよ。

```{r}
```

#### R-026

> レシート明細データフレーム（df_receipt）に対し、顧客ID（customer_id）ごとに最も新
しい売上日（sales_ymd）と古い売上日を求め、両者が異なるデータを10件表示せよ。

```{r}
```

#### R-027

> レシート明細データフレーム（df_receipt）に対し、店舗コード（store_cd）ごとに売上
金額（amount）の平均を計算し、降順でTOP5を表示せよ。

```{r}
```

#### R-028

> レシート明細データフレーム（df_receipt）に対し、店舗コード（store_cd）ごとに売上
金額（amount）の中央値を計算し、降順でTOP5を表示せよ。

```{r}
```


#### R-029

> レシート明細データフレーム（df_receipt）に対し、店舗コード（store_cd）ごとに商品
コード（product_cd）の最頻値を求めよ。

```{r}
```

#### R-030

> レシート明細データフレーム（df_receipt）に対し、店舗コード（store_cd）ごとに売上
金額（amount）の標本分散を計算し、降順でTOP5を表示せよ。

```{r}
```

#### R-031

> レシート明細データフレーム（df_receipt）に対し、店舗コード（store_cd）ごとに売上
金額（amount）の標本標準偏差を計算し、降順でTOP5を表示せよ。

```{r}
```

#### R-032

> レシート明細データフレーム（df_receipt）の売上金額（amount）について、25％刻みで
パーセンタイル値を求めよ。

```{r}
```

#### R-033

> レシート明細データフレーム（df_receipt）に対し、店舗コード（store_cd）ごとに売上
金額（amount）の平均を計算し、330以上のものを抽出せよ。

```{r}
```

### 034-035 副問合せ

#### R-034

> レシート明細データフレーム（df_receipt）に対し、顧客ID（customer_id）ごとに売上金
額（amount）を合計して全顧客の平均を求めよ。ただし、顧客IDが"Z"から始まるのもの
は非会員を表すため、除外して計算すること。


R-023 を利用すると楽。

```{r}
```

#### R-035

> レシート明細データフレーム（df_receipt）に対し、顧客ID（customer_id）ごとに売上金
額（amount）を合計して全顧客の平均を求め、平均以上に買い物をしている顧客を抽出
せよ。ただし、顧客IDが"Z"から始まるのものは非会員を表すため、除外して計算するこ
と。なお、データは10件だけ表示させれば良い。

R-034 を利用すると楽。

```{r}
```

### 036-042 結合

#### R-036

> レシート明細データフレーム（df_receipt）と店舗データフレーム（df_store）を内部結
合し、レシート明細データフレームの全項目と店舗データフレームの店舗名
（store_name）を10件表示させよ。

```{r}
```


#### R-037

> 商品データフレーム（df_product）とカテゴリデータフレーム（df_category）を内部結合
し、商品データフレームの全項目とカテゴリデータフレームの小区分名
（category_small_name）を10件表示させよ。

```{r}
```


#### R-038

> 顧客データフレーム（df_customer）とレシート明細データフレーム（df_receipt）か
ら、各顧客ごとの売上金額合計を求めよ。ただし、買い物の実績がない顧客については売
上金額を0として表示させること。また、顧客は性別コード（gender_cd）が女性（1）で
あるものを対象とし、非会員（顧客IDが'Z'から始まるもの）は除外すること。なお、結果
は10件だけ表示させれば良い。

```{r}
```

#### R-039

> レシート明細データフレーム（df_receipt）から売上日数の多い顧客の上位20件と、売上
金額合計の多い顧客の上位20件を抽出し、完全外部結合せよ。ただし、非会員（顧客IDが
'Z'から始まるもの）は除外すること。

```{r}
```

#### R-040

> 全ての店舗と全ての商品を組み合わせると何件のデータとなるか調査したい。店舗
（df_store）と商品（df_product）を直積した件数を計算せよ。

df_receipt を間に挟まないと組み合わせにならないから、df_receipt だけでいいような気がする？

```{r}
```

#### R-041

> レシート明細データフレーム（df_receipt）の売上金額（amount）を日付（sales_ymd）
ごとに集計し、前日からの売上金額増減を計算せよ。なお、計算結果は10件表示すればよ
い。

```{r}
```

#### R-042

> レシート明細データフレーム（df_receipt）の売上金額（amount）を日付（sales_ymd）
ごとに集計し、各日付のデータに対し、１日前、２日前、３日前のデータを結合せよ。結
果は10件表示すればよい。

R-041 より先にやったほうがいい。

```{r}
```

### 043-044 縦横変換

#### R-043

> レシート明細データフレーム（df_receipt）と顧客データフレーム（df_customer）を結
合し、性別（gender）と年代（ageから計算）ごとに売上金額（amount）を合計した売上
サマリデータフレーム（df_sales_summary）を作成せよ。性別は0が男性、1が女性、9が
不明を表すものとする。
ただし、項目構成は年代、女性の売上金額、男性の売上金額、性別不明の売上金額の4項
目とすること（縦に年代、横に性別のクロス集計）。また、年代は10歳ごとの階級とする
こと。

```{r}
```

#### R-044

> 前設問で作成した売上サマリデータフレーム（df_sales_summary）は性別の売上を横持
ちさせたものであった。このデータフレームから性別を縦持ちさせ、年代、性別コード、
売上金額の3項目に変換せよ。ただし、性別コードは男性を'00'、女性を'01'、不明を'99'と
する。

R-043 より先にしたほうがいいんじゃない？

```{r}
```

### 045-058 データ変換

#### R-045

> 顧客データフレーム（df_customer）の生年月日（birth_day）は日付型（Date）でデータ
を保有している。これをYYYYMMDD形式の文字列に変換し、顧客ID（customer_id）と
ともに抽出せよ。データは10件を抽出すれば良い。

```{r}
```

#### R-046

> 顧客データフレーム（df_customer）の申し込み日（application_date）はYYYYMMD形
式の文字列型でデータを保有している。これを日付型（dateやdatetime）に変換し、顧客
ID（customer_id）とともに抽出せよ。データは10件を抽出すれば良い。

```{r}
```

#### R-047

> レシート明細データフレーム（df_receipt）の売上日（sales_ymd）はYYYYMMDD形式の
数値型でデータを保有している。これを日付型（dateやdatetime）に変換し、レシート番
号(receipt_no)、レシートサブ番号（receipt_sub_no）とともに抽出せよ。データは10件
を抽出すれば良い。

```{r}
```

#### R-048

> レシート明細データフレーム（df_receipt）の売上エポック秒（sales_epoch）は数値型
のUNIX秒でデータを保有している。これを日付型（POSIXct）に変換し、レシー
ト番号(receipt_no)、レシートサブ番号（receipt_sub_no）とともに抽出せよ。データは
10件を抽出すれば良い。

```{r}
```

#### R-049

> レシート明細データフレーム（df_receipt）の売上エポック秒（sales_epoch）を日付型
（POSIXct）に変換し、"年"だけ取り出してレシート番号(receipt_no)、レシートサブ
番号（receipt_sub_no）とともに抽出せよ。データは10件を抽出すれば良い。

```{r}
```

#### R-050

> レシート明細データフレーム（df_receipt）の売上エポック秒（sales_epoch）を日付型
（POSIXct）に変換し、"月"だけ取り出してレシート番号(receipt_no)、レシートサブ
番号（receipt_sub_no）とともに抽出せよ。なお、"月"は0埋め2桁で取り出すこと。デー
タは10件を抽出すれば良い。

```{r}
```

#### R-051

> レシート明細データフレーム（df_receipt）の売上エポック秒（sales_epoch）を日付型
（POSIXct）に変換し、"日"だけ取り出してレシート番号(receipt_no)、レシートサブ
番号（receipt_sub_no）とともに抽出せよ。なお、"日"は0埋め2桁で取り出すこと。デー
タは10件を抽出すれば良い。

```{r}
```

#### R-052

> レシート明細データフレーム（df_receipt）の売上金額（amount）を顧客ID
（customer_id）ごとに合計の上、売上金額合計に対して2000円以下を0、2000円超を1に
2値化し、顧客ID、売上⾦額合計とともに10件表⽰せよ。ただし、顧客IDが"Z"から始まる
のものは非会員を表すため、除外して計算すること。

```{r}
```

#### R-053

> 顧客データフレーム（df_customer）の郵便番号（postal_cd）に対し、東京（先頭3桁が
100〜209のもの）を1、それ以外のものを0に２値化せよ。さらにレシート明細データフ
レーム（df_receipt）と結合し、全期間において買い物実績のある顧客数を、作成した2値
ごとにカウントせよ。

```{r}
```

#### R-054

> 顧客データデータフレーム（df_customer）の住所（address）は、埼玉県、千葉県、東
京都、神奈川県のいずれかとなっている。都道府県毎にコード値を作成し、顧客ID、住所
とともに抽出せよ。値は埼玉県を11、千葉県を12、東京都を13、神奈川県を14とするこ
と。結果は10件表示させれば良い。

```{r}
```

#### R-055

> レシート明細データフレーム（df_receipt）の売上金額（amount）を顧客ID
（customer_id）ごとに合計し、その合計金額の四分位点を求めよ。その上で、顧客ごと
の売上金額合計に対して以下の基準でカテゴリ値を作成し、顧客ID、売上金額と合計とも
に表示せよ。カテゴリ値は上から順に1〜4とする。結果は10件表示させれば良い。
> 
> * 最⼩値以上第⼀四分位未満
> * 第⼀四分位以上第⼆四分位未満
> * 第⼆四分位以上第三四分位未満
> * 第三四分位以上

```{r}
```

#### R-056

> 顧客データフレーム（df_customer）の年齢（age）をもとに10歳刻みで年代を算出し、
顧客ID（customer_id）、生年月日（birth_day）とともに抽出せよ。ただし、60歳以上は
全て60歳代とすること。年代を表すカテゴリ名は任意とする。先頭10件を表示させればよ
い。

```{r}
```

#### R-057

> 前問題の抽出結果と性別（gender）を組み合わせ、新たに性別×年代の組み合わせを表す
カテゴリデータを作成せよ。組み合わせを表すカテゴリの値は任意とする。先頭10件を表
示させればよい。

```{r}
```

#### R-058

> 顧客データフレーム（df_customer）の性別コード（gender_cd）をダミー変数化し、顧
客ID（customer_id）とともに抽出せよ。結果は10件表示させれば良い。

```{r}
```

### 059-062 数値変換

#### R-059

> レシート明細データフレーム（df_receipt）の売上金額（amount）を顧客ID（customer_id）ごとに合計し、売上金額合計を平均0、標準偏差1に標準化して顧客ID、売上金額合計とともに表示せよ。標準化に使用する標準偏差は、不偏標準偏差と標本標準偏差のどちらでも良いものとする。ただし、顧客IDが"Z"から始まるのものは非会員を表すため、除外して計算すること。結果は10件表示させれば良い。

```{r}
```

#### R-060

> レシート明細データフレーム（df_receipt）の売上金額（amount）を顧客ID
（customer_id）ごとに合計し、合計した売上金額を最小値0、最大値1に正規化して顧客
ID、売上⾦額合計とともに表⽰せよ。ただし、顧客IDが"Z"から始まるのものは⾮会員を
表すため、除外して計算すること。結果は10件表示させれば良い。

```{r}
```

#### R-061

> レシート明細データフレーム（df_receipt）の売上金額（amount）を顧客ID
（customer_id）ごとに合計し、合計した売上金額を常用対数化（底=10）して顧客ID、
売上金額合計とともに表示せよ。ただし、顧客IDが"Z"から始まるのものは非会員を表す
ため、除外して計算すること。結果は10件表示させれば良い。

```{r}
```

#### R-062

> レシート明細データフレーム（df_receipt）の売上金額（amount）を顧客ID
（customer_id）ごとに合計し、合計した売上金額を自然対数化(底=e）して顧客ID、売上
金額合計とともに表示せよ。ただし、顧客IDが"Z"から始まるのものは非会員を表すた
め、除外して計算すること。結果は10件表示させれば良い。

```{r}
```

### 063-069 四則演算

#### R-063

> 商品データフレーム（df_product）の単価（unit_price）と原価（unit_cost）から、各商
品の利益額を算出せよ。結果は10件表示させれば良い。

```{r}
```

#### R-064

> 商品データフレーム（df_product）の単価（unit_price）と原価（unit_cost）から、各商
品の利益率の全体平均を算出せよ。
ただし、単価と原価にはNULLが存在することに注意せよ。

```{r}
```

#### R-065

> 商品データフレーム（df_product）の各商品について、利益率が30%となる新たな単価を
求めよ。ただし、1円未満は切り捨てること。そして結果を10件表示させ、利益率がおよ
そ30％付近であることを確認せよ。ただし、単価（unit_price）と原価（unit_cost）には
NULLが存在することに注意せよ。

```{r}
```

#### R-066

> 商品データフレーム（df_product）の各商品について、利益率が30%となる新たな単価を
求めよ。今回は、1円未満を四捨五入すること（0.5については偶数方向の丸めで良い）。
そして結果を10件表示させ、利益率がおよそ30％付近であることを確認せよ。ただし、単
価（unit_price）と原価（unit_cost）にはNULLが存在することに注意せよ。

```{r}
```

#### R-067

> 商品データフレーム（df_product）の各商品について、利益率が30%となる新たな単価を
求めよ。今回は、1円未満を切り上げること。そして結果を10件表示させ、利益率がおよ
そ30％付近であることを確認せよ。ただし、単価（unit_price）と原価（unit_cost）には
NULLが存在することに注意せよ。

```{r}
```

#### R-068

> 商品データフレーム（df_product）の各商品について、消費税率10%の税込み金額を求め
よ。 1円未満の端数は切り捨てとし、結果は10件表示すれば良い。ただし、単価
（unit_price）にはNULLが存在することに注意せよ。

```{r}
```

#### R-069

> レシート明細データフレーム（df_receipt）と商品データフレーム（df_product）を結合
し、顧客毎に全商品の売上金額合計と、カテゴリ大区分（category_major_cd）が"07"
（瓶詰缶詰）の売上金額合計を計算の上、両者の比率を求めよ。抽出対象はカテゴリ大区
分"07"（瓶詰缶詰）の購入実績がある顧客のみとし、結果は10件表示させればよい。

```{r}
```

### 070-074 日付型の計算

#### R-070

> レシート明細データフレーム（df_receipt）の売上日（sales_ymd）に対し、顧客データ
フレーム（df_customer）の会員申込日（application_date）からの経過日数を計算し、顧
客ID（customer_id）、売上日、会員申込日とともに表示せよ。結果は10件表示させれば
良い（なお、sales_ymdは数値、application_dateは文字列でデータを保持している点に
注意）。

```{r}
```

#### R-071

> レシート明細データフレーム（df_receipt）の売上日（sales_ymd）に対し、顧客データ
フレーム（df_customer）の会員申込日（application_date）からの経過月数を計算し、顧
客ID（customer_id）、売上日、会員申込日とともに表示せよ。結果は10件表示させれば
良い（なお、sales_ymdは数値、application_dateは文字列でデータを保持している点に
注意）。1ヶ月未満は切り捨てること。

```{r}
```

#### R-072

> レシート明細データフレーム（df_receipt）の売上日（sales_ymd）に対し、顧客データ
フレーム（df_customer）の会員申込日（application_date）からの経過年数を計算し、顧
客ID（customer_id）、売上日、会員申込日とともに表示せよ。結果は10件表示させれば
良い。（なお、sales_ymdは数値、application_dateは文字列でデータを保持している点
に注意）。1年未満は切り捨てること。

```{r}
```

#### R-073

> レシート明細データフレーム（df_receipt）の売上日（sales_ymd）に対し、顧客データ
フレーム（df_customer）の会員申込日（application_date）からのエポック秒による経過
時間を計算し、顧客ID（customer_id）、売上日、会員申込日とともに表示せよ。結果は
10件表⽰させれば良い（なお、sales_ymdは数値、application_dateは⽂字列でデータを
保持している点に注意）。なお、時間情報は保有していないため各日付は0時0分0秒を表
すものとする。

```{r}
```

#### R-074

> レシート明細データフレーム（df_receipt）の売上日（sales_ymd）に対し、当該週の月
曜日からの経過日数を計算し、売上日、当該週の月曜日付とともに表示せよ。結果は10件
表示させれば良い（なお、sales_ymdは数値でデータを保持している点に注意）。

```{r}
```

### 075-076 サンプリング

#### R-075

> 顧客データフレーム（df_customer）からランダムに1%のデータを抽出し、先頭から10件
データを抽出せよ。

```{r}
```

#### R-076

> 顧客データフレーム（df_customer）から性別（gender_cd）の割合に基づきランダムに
10%のデータを層化抽出データし、性別ごとに件数を集計せよ。

```{r}
```

### 077-078 外れ値・異常値

#### R-077

> レシート明細データフレーム（df_receipt）の売上金額（amount）を顧客単位に合計し、
合計した売上金額の外れ値を抽出せよ。ただし、顧客IDが"Z"から始まるのものは非会員
を表すため、除外して計算すること。なお、ここでは外れ値を平均から3σ以上離れたも
のとする。結果は10件表示させれば良い。

```{r}
```

#### R-078

> レシート明細データフレーム（df_receipt）の売上金額（amount）を顧客単位に合計し、
合計した売上金額の外れ値を抽出せよ。ただし、顧客IDが"Z"から始まるのものは非会員
を表すため、除外して計算すること。なお、ここでは外れ値を第一四分位と第三四分位の
差であるIQRを用いて、「第一四分位数-1.5×IQR」よりも下回るもの、または「第三四分
位数+1.5×IQR」を超えるものとする。結果は10件表示させれば良い。

```{r}
```

### 079-083 欠損値

#### R-079

> 商品データフレーム（df_product）の各項目に対し、欠損数を確認せよ。

```{r}
```

#### R-080

> 商品データフレーム（df_product）のいずれかの項目に欠損が発生しているレコードを全
て削除した新たなdf_product_1を作成せよ。なお、削除前後の件数を表示させ、前設問で
確認した件数だけ減少していることも確認すること。

```{r}
```

#### R-081

> 単価（unit_price）と原価（unit_cost）の欠損値について、それぞれの平均値で補完した
新たなdf_product_2を作成せよ。なお、平均値について1円未満は四捨五入とし、0.5につ
いては偶数寄せでかまわない。補完実施後、各項目について欠損が生じていないことも確
認すること。

```{r}
```

#### R-082

> 単価（unit_price）と原価（unit_cost）の欠損値について、それぞれの中央値で補完した
新たなdf_product_3を作成せよ。なお、中央値について1円未満は四捨五入とし、0.5につ
いては偶数寄せでかまわない。補完実施後、各項目について欠損が生じていないことも確
認すること

```{r}
```

#### R-083

> 単価（unit_price）と原価（unit_cost）の欠損値について、各商品の小区分
（category_small_cd）ごとに算出した中央値で補完した新たなdf_product_4を作成せ
よ。なお、中央値について1円未満は四捨五入とし、0.5については偶数寄せでかまわな
い。補完実施後、各項目について欠損が生じていないことも確認すること。

```{r}
```

### 084 除算エラー対応

#### R-084

> 顧客データフレーム（df_customer）の全顧客に対し、全期間の売上金額に占める2019年売上金額の割合を計算せよ。ただし、販売実績のない場合は0として扱うこと。そして計算した割合が0超のものを抽出せよ。 結果は10件表示させれば良い。また、作成したデータにNAやNANが存在しないことを確認せよ。

```{r}
```

### 085-086 座標データ

#### R-085

> 顧客データフレーム（df_customer）の全顧客に対し、郵便番号（postal_cd）を用いて経
度緯度変換用データフレーム（df_geocode）を紐付け、新たなdf_customer_1を作成せ
よ。ただし、複数紐づく場合は経度（longitude）、緯度（latitude）それぞれ平均を算出
すること。

```{r}
```

#### R-086

> 前設問で作成した緯度経度つき顧客データフレーム（df_customer_1）に対し、申込み店
舗コード（application_store_cd）をキーに店舗データフレーム（df_store）と結合せ
よ。そして申込み店舗の緯度（latitude）・経度情報（longitude)と顧客の緯度・経度を用
いて距離（km）を求め、顧客ID（customer_id）、顧客住所（address）、店舗住所
（address）とともに表示せよ。計算式は簡易式で良いものとするが、その他精度の高い
方式を利用したライブラリを利用してもかまわない。結果は10件表示すれば良い。

```{r}
```

### 087-088 名寄せ

#### R-087

> 顧客データフレーム（df_customer）では、異なる店舗での申込みなどにより同一顧客が
複数登録されている。名前（customer_name）と郵便番号（postal_cd）が同じ顧客は同
一顧客とみなし、1顧客1レコードとなるように名寄せした名寄顧客データフレーム
（df_customer_u）を作成せよ。ただし、同一顧客に対しては売上金額合計が最も高いも
のを残すものとし、売上金額合計が同一もしくは売上実績の無い顧客については顧客ID
（customer_id）の番号が小さいものを残すこととする。

```{r}
```

#### R-088

> 前設問で作成したデータを元に、顧客データフレームに統合名寄IDを付与したデータフ
レーム（df_customer_n）を作成せよ。ただし、統合名寄IDは以下の仕様で付与するもの
とする。
> 
> * 重複していない顧客：顧客ID（customer_id）を設定
> * 重複している顧客：前設問で抽出したレコードの顧客IDを設定

```{r}
```

### 089-090 データ分割

#### R-089

> 売上実績のある顧客に対し、予測モデル構築のため学習用データとテスト用データに分割
したい。それぞれ8:2の割合でランダムにデータを分割せよ。

```{r}
```

#### R-090

> レシート明細データフレーム（df_receipt）は2017年1月1日〜2019年10月31日までのデー
タを有している。売上金額（amount）を月次で集計し、学習用に12ヶ月、テスト用に6ヶ
月のモデル構築用データを3セット作成せよ。

```{r}
```

### 091 不均衡データ

#### R-091

> 顧客データフレーム（df_customer）の各顧客に対し、売上実績のある顧客数と売上実績
のない顧客数が1:1となるようにアンダーサンプリングで抽出せよ。

```{r}
```

### 092-094 正規化・非正規化

#### R-092

> 顧客データフレーム（df_customer）では、性別に関する情報が非正規化の状態で保持さ
れている。これを第三正規化せよ。

```{r}
```

#### R-093

> 商品データフレーム（df_product）では各カテゴリのコード値だけを保有し、カテゴリ名
は保有していない。カテゴリデータフレーム（df_category）と組み合わせて非正規化
し、カテゴリ名を保有した新たな商品データフレームを作成せよ。

```{r}
```

#### R-094

> 先に作成したカテゴリ名付き商品データを以下の仕様でファイル出力せよ。なお、出力先
のパスはdata配下とする。
>
> * ファイル形式はCSV（カンマ区切り）
> * ヘッダ有り
> * ⽂字コードはUTF-8

```{r}
```

### 095-100 ファイル入出力

#### R-095

> 先に作成したカテゴリ名付き商品データを以下の仕様でファイル出力せよ。なお、出力先
のパスはdata配下とする。
> 
> * ファイル形式はCSV（カンマ区切り）
> * ヘッダ有り
> * ⽂字コードはCP932

```{r}
```

#### R-096

> 先に作成したカテゴリ名付き商品データを以下の仕様でファイル出力せよ。なお、出力先
のパスはdata配下とする。
>
> * ファイル形式はCSV（カンマ区切り）
> * ヘッダ無し
> * ⽂字コードはUTF-8

```{r}
```

#### R-097

> 先に作成した以下形式のファイルを読み込み、データフレームを作成せよ。また、先頭10
件を表示させ、正しくとりまれていることを確認せよ。
> 
> * ファイル形式はCSV（カンマ区切り）
> * ヘッダ有り
> * ⽂字コードはUTF-8

```{r}
```

#### R-098

> 先に作成した以下形式のファイルを読み込み、データフレームを作成せよ。また、先頭10
件を表示させ、正しくとりまれていることを確認せよ。
> 
> * ファイル形式はCSV（カンマ区切り）
> * ヘッダ無し
> * ⽂字コードはUTF-8

```{r}
```

#### R-099

> 先に作成したカテゴリ名付き商品データを以下の仕様でファイル出力せよ。なお、出力先
のパスはdata配下とする。
>
> * ファイル形式はTSV（タブ区切り）
> * ヘッダ有り
> * ⽂字コードはUTF-8

```{r}
```

#### R-100

> 先に作成した以下形式のファイルを読み込み、データフレームを作成せよ。また、先頭10
件を表示させ、正しくとりまれていることを確認せよ。
>
> * ファイル形式はTSV（タブ区切り）
> * ヘッダ有り
> * ⽂字コードはUTF-8

```{r}
```
